{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Add Product</title>

  <!-- OLD CSS (unchanged) -->
  <link rel="stylesheet" href="{% static 'css/admin_style.css' %}">
  <link rel="stylesheet" href="{% static 'css/wizard.css' %}">
</head>

<body>

  <!-- Nav Bar -->
  {% include "admin_navbar.html" %}

  <!-- ================= MAIN ================= -->
  <main class="main">

    <div class="topbar">
      <h2>Add Product</h2>
    </div>

    <div class="card">

      {% if messages %}
      <div class="messages">
        {% for message in messages %}
        <p class="alert {{ message.tags }}">{{ message }}</p>
        {% endfor %}
      </div>
      {% endif %}

      <h3>Add Product</h3>

      <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}

        <!-- ================= PRODUCT DETAILS ================= -->
        <h4>Product Details</h4>

        <input type="text" name="product_name" placeholder="Product Name" required>
        <textarea name="description" placeholder="Description" required></textarea>

        <select name="category_id" required>
          <option value="" disabled selected>Select Category</option>
          {% for category in categories %}
          <option value="{{ category.category_id }}">{{ category.category_name }}</option>
          {% endfor %}
        </select>

        <hr>

        <!-- ================= PRODUCT IMAGES ================= -->
        <h4>Product Images</h4>

        <label>Upload Product Images</label>
        <input type="file" name="product_images" id="product_images" multiple accept="image/*" required>

        <input type="hidden" name="primary_image_index" id="primary_image_index" value="0">

        <div class="image-preview" id="imagePreview"></div>

        <hr>

        <!-- ================= VARIANTS ================= -->
        <h4>Variants</h4>

        <div id="variants-container">

          <!-- FIRST VARIANT (COMPULSORY, NO REMOVE BUTTON) -->
          <div class="variant-block" data-variant-index="0">

            <input type="text" name="variants[0][name]" placeholder="Variant Name" required>
            <input type="text" name="variants[0][price]" placeholder="Price" required>
            <input type="text" name="variants[0][compare_at_price]" placeholder="Compare At Price" required>

            <input type="text" value="0" readonly placeholder="Stock (auto calculated by batch)">

            <label>Variant Images</label>
            <input type="file" name="variants[0][images]" multiple accept="image/*" class="variant-images-input"
              data-variant-index="0" required>

            <div class="image-preview variant-preview" id="variant-preview-0"></div>

            <hr>
          </div>

        </div>

        <button type="button" class="btn btn-gray" onclick="addVariant()">
          + Add Another Variant
        </button>



        <br><br>

        <!-- ================= SUBMIT ================= -->
        <button type="submit" class="btn btn-green">
          Save Product
        </button>

      </form>
    </div>
  </main>
  </div>

  <!-- ================= JS ================= -->
  <script src="{% static 'js/add_product.js'%}"></script>
  <script src="{% static 'js/admin_script.js'%}"></script>

</body>

</html>